sync:
  image: n3llyb0y/wait
  links:
    - admin-ui
    - auth
    - confd
    - postgres
    - provd
    - rabbitmq
    - sysconfd
  environment:
    PORTS: "5432 5672 8666 8668 9296 9486 9497"
    TIMEOUT: "${INTEGRATION_TEST_TIMEOUT}"

admin-ui:
  image: wazo-admin-ui-test
  ports:
    - "19296:9296"
  links:
    - confd
    - auth
  volumes:
    - "../../..:/usr/src/wazo-admin-ui"
    - "./etc/wazo-admin-ui:/etc/wazo-admin-ui"
    - "./ssl:/usr/local/share/ssl"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-conference/conference:/usr/src/wazo-admin-ui-conference/conference"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-group/group:/usr/src/wazo-admin-ui-group/group"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-incall/incall:/usr/src/wazo-admin-ui-incall/incall"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-moh/moh:/usr/src/wazo-admin-ui-moh/moh"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-outcall/outcall:/usr/src/wazo-admin-ui-outcall/outcall"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-paging/paging:/usr/src/wazo-admin-ui-paging/paging"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-parking-lot/parking_lot:/usr/src/wazo-admin-ui-parking-lot/parking_lot"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-switchboard/switchboard:/usr/src/wazo-admin-ui-switchboard/switchboard"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-user/user:/usr/src/wazo-admin-ui-user/user"
    # - "${LOCAL_GIT_REPOS}/wazo-admin-ui-voicemail/voicemail:/usr/src/wazo-admin-ui-voicemail/voicemail"

auth:
  image: p0bailey/docker-flask
  ports:
    - "9497"
  volumes:
    - "./mocks/auth.py:/tmp/auth.py"
    - "./ssl:/usr/local/share/ssl"
  command: "python /tmp/auth.py"

confd:
  image: wazopbx/xivo-confd
  expose:
    - "9486"
  links:
    - auth
    - postgres
    - provd
    - rabbitmq
    - sysconfd
  volumes:
    - "./etc/xivo-confd:/etc/xivo-confd"
    - "./ssl:/usr/local/share/ssl"

postgres:
  image: wazopbx/postgres-test
  expose:
    - "5432"

provd:
  image: wazopbx/xivo-provd
  expose:
    - "8666"
  volumes:
    - "./etc/xivo-provd/provd.conf:/etc/xivo/provd/provd.conf"

rabbitmq:
  image: rabbitmq
  expose:
    - "5672"

sysconfd:
  image: p0bailey/docker-flask
  expose:
    - "8668"
  volumes:
    - "./mocks/sysconfd.py:/tmp/sysconfd.py"
  command: "python /tmp/sysconfd.py"
